import{_ as Re}from"../chunks/preload-helper.a4192956.js";import{s as Me,y as be,M as Te,N as Ie,h as A,d as b,j as y,O as Ce,i as q,A as P,B as H,L as Pe,F as Ne,G as Ee,H as Se,I as J,a as K,f as F,V as je,c as Y,g as z,o as Ge,Q as $e,l as W,m as Q}from"../chunks/scheduler.d583122a.js";import{S as Ue,i as Be,t as x,c as ye,a as C,g as De,b as oe,d as te,m as se,e as re}from"../chunks/index.6f9a916b.js";import{p as qe}from"../chunks/index.f2bf1820.js";import{L as Ze,a as He,x as Ke,B as ce}from"../chunks/misc.aef7f343.js";import{a as Z}from"../chunks/snackbar.76b9f199.js";import"../chunks/singletons.32ef462a.js";import{K as he}from"../chunks/index.9c9c4205.js";import{t as Fe,g as Ye}from"../chunks/db.1a03e27e.js";import{p as c}from"../chunks/progress-tracker.40634f97.js";function Je(r){let e,o,t,i,h,m=[{xmlns:"http://www.w3.org/2000/svg"},{fill:"currentColor"},r[4],{class:t=Fe("shrink-0",r[3][r[0]],r[5].class)},{role:r[1]},{"aria-label":r[2]},{viewBox:"0 0 18 19"}],v={};for(let u=0;u<m.length;u+=1)v=be(v,m[u]);return{c(){e=Te("svg"),o=Te("path"),this.h()},l(u){e=Ie(u,"svg",{xmlns:!0,fill:!0,class:!0,role:!0,"aria-label":!0,viewBox:!0});var p=A(e);o=Ie(p,"path",{fill:!0,"fill-rule":!0,d:!0,"clip-rule":!0}),A(o).forEach(b),p.forEach(b),this.h()},h(){y(o,"fill","currentColor"),y(o,"fill-rule","evenodd"),y(o,"d","M8.842 18.083A8.8 8.8 0 0 1 .193 9.135a8.841 8.841 0 0 1 8.8-8.652h.152a8.464 8.464 0 0 1 5.7 2.257l-2.193 2.038A5.27 5.27 0 0 0 9.091 3.4a5.882 5.882 0 0 0-.2 11.761h.124a5.091 5.091 0 0 0 5.248-4.058L14.3 11H9V8h8.341c.065.543.094 1.09.087 1.636-.086 5.053-3.463 8.449-8.4 8.449l-.186-.002Z"),y(o,"clip-rule","evenodd"),Ce(e,v)},m(u,p){q(u,e,p),P(e,o),i||(h=[H(e,"click",r[6]),H(e,"keydown",r[7]),H(e,"keyup",r[8]),H(e,"focus",r[9]),H(e,"blur",r[10]),H(e,"mouseenter",r[11]),H(e,"mouseleave",r[12]),H(e,"mouseover",r[13]),H(e,"mouseout",r[14])],i=!0)},p(u,[p]){Ce(e,v=Ye(m,[{xmlns:"http://www.w3.org/2000/svg"},{fill:"currentColor"},p&16&&u[4],p&33&&t!==(t=Fe("shrink-0",u[3][u[0]],u[5].class))&&{class:t},p&2&&{role:u[1]},p&4&&{"aria-label":u[2]},{viewBox:"0 0 18 19"}]))},i:Pe,o:Pe,d(u){u&&b(e),i=!1,Ne(h)}}}function We(r,e,o){const t=["size","role","ariaLabel"];let i=Ee(e,t),{size:h="md"}=e,{role:m="img"}=e;const v={xs:"w-3 h-3",sm:"w-4 h-4",md:"w-5 h-5",lg:"w-6 h-6",xl:"w-8 h-8"};let{ariaLabel:u="google solid"}=e;function p(f){J.call(this,r,f)}function _(f){J.call(this,r,f)}function w(f){J.call(this,r,f)}function M(f){J.call(this,r,f)}function R(f){J.call(this,r,f)}function D(f){J.call(this,r,f)}function le(f){J.call(this,r,f)}function X(f){J.call(this,r,f)}function E(f){J.call(this,r,f)}return r.$$set=f=>{o(5,e=be(be({},e),Se(f))),o(4,i=Ee(e,t)),"size"in f&&o(0,h=f.size),"role"in f&&o(1,m=f.role),"ariaLabel"in f&&o(2,u=f.ariaLabel)},e=Se(e),[h,m,u,v,i,e,p,_,w,M,R,D,le,X,E]}class Qe extends Ue{constructor(e){super(),Be(this,e,We,Je,Me,{size:0,role:1,ariaLabel:2})}}const Xe="https://www.googleapis.com/upload/drive/v3/files";async function ze({accessToken:r,fileId:e,localStorageId:o,metadata:t,type:i}){const h=localStorage.getItem(o)||"",m=new Blob([h],{type:i}),v=new FormData;return v.append("resource",new Blob([JSON.stringify(t)],{type:i})),v.append("file",m),await(await fetch(`${Xe}${e?`/${e}`:""}?uploadType=multipart`,{method:e?"PATCH":"POST",headers:new Headers({Authorization:"Bearer "+r}),body:v})).json()}function eo(r){let e,o,t,i,h,m,v="Connect to Google Drive",u,p,_;return i=new Qe({props:{size:"lg"}}),{c(){e=F("div"),o=F("button"),t=F("div"),oe(i.$$.fragment),h=K(),m=F("h2"),m.textContent=v,this.h()},l(w){e=z(w,"DIV",{class:!0});var M=A(e);o=z(M,"BUTTON",{class:!0});var R=A(o);t=z(R,"DIV",{class:!0});var D=A(t);te(i.$$.fragment,D),h=Y(D),m=z(D,"H2",{class:!0,"data-svelte-h":!0}),$e(m)!=="svelte-1b9un9c"&&(m.textContent=v),D.forEach(b),R.forEach(b),M.forEach(b),this.h()},h(){y(m,"class","text-lg"),y(t,"class","flex sm:flex-row flex-col gap-2 items-center justify-center"),y(o,"class","w-full border rounded-lg border-slate-600 p-10 border-opacity-50 hover:bg-slate-800 max-w-3xl"),y(e,"class","flex justify-center pt-0 sm:pt-32")},m(w,M){q(w,e,M),P(e,o),P(o,t),se(i,t,null),P(t,h),P(t,m),u=!0,p||(_=H(o,"click",r[4]),p=!0)},p:Pe,i(w){u||(C(i.$$.fragment,w),u=!0)},o(w){x(i.$$.fragment,w),u=!1},d(w){w&&b(e),re(i),p=!1,_()}}}function oo(r){let e,o,t,i="Google Drive:",h,m,v,u,p,_,w,M,R,D,le="You can select multiple ZIP/CBZ files or entire folders at once.",X,E,f,ae,U,B,ne,de,N,j,ue,l;m=new ce({props:{color:"red",$$slots:{default:[to]},$$scope:{ctx:r}}}),m.$on("click",r[1]),f=new ce({props:{color:"blue",$$slots:{default:[so]},$$scope:{ctx:r}}}),f.$on("click",r[5]),B=new ce({props:{color:"dark",$$slots:{default:[ro]},$$scope:{ctx:r}}}),B.$on("click",r[11]);let s=r[2]&&Le(r);j=new ce({props:{color:"dark",$$slots:{default:[ao]},$$scope:{ctx:r}}}),j.$on("click",r[13]);let a=r[3]&&Ve(r);return{c(){e=F("div"),o=F("div"),t=F("h2"),t.textContent=i,h=K(),oe(m.$$.fragment),v=K(),u=F("p"),p=W("Add your zipped manga files (ZIP or CBZ) to the "),_=F("span"),w=W(_e),M=W(` folder
        in your Google Drive.`),R=K(),D=F("p"),D.textContent=le,X=K(),E=F("div"),oe(f.$$.fragment),ae=K(),U=F("div"),oe(B.$$.fragment),ne=K(),s&&s.c(),de=K(),N=F("div"),oe(j.$$.fragment),ue=K(),a&&a.c(),this.h()},l(n){e=z(n,"DIV",{class:!0});var d=A(e);o=z(d,"DIV",{class:!0});var g=A(o);t=z(g,"H2",{class:!0,"data-svelte-h":!0}),$e(t)!=="svelte-1dpf5jc"&&(t.textContent=i),h=Y(g),te(m.$$.fragment,g),g.forEach(b),v=Y(d),u=z(d,"P",{class:!0});var $=A(u);p=Q($,"Add your zipped manga files (ZIP or CBZ) to the "),_=z($,"SPAN",{class:!0});var T=A(_);w=Q(T,_e),T.forEach(b),M=Q($,` folder
        in your Google Drive.`),$.forEach(b),R=Y(d),D=z(d,"P",{class:!0,"data-svelte-h":!0}),$e(D)!=="svelte-1bj18pj"&&(D.textContent=le),X=Y(d),E=z(d,"DIV",{class:!0});var I=A(E);te(f.$$.fragment,I),ae=Y(I),U=z(I,"DIV",{class:!0});var L=A(U);te(B.$$.fragment,L),ne=Y(L),s&&s.l(L),L.forEach(b),de=Y(I),N=z(I,"DIV",{class:!0});var S=A(N);te(j.$$.fragment,S),ue=Y(S),a&&a.l(S),S.forEach(b),I.forEach(b),d.forEach(b),this.h()},h(){y(t,"class","text-3xl font-semibold text-center pt-2"),y(o,"class","flex justify-between items-center w-full max-w-3xl"),y(_,"class","text-primary-700"),y(u,"class","text-center"),y(D,"class","text-center text-sm text-gray-500"),y(U,"class","flex-col gap-2 flex"),y(N,"class","flex-col gap-2 flex"),y(E,"class","flex flex-col gap-4 w-full max-w-3xl"),y(e,"class","flex justify-between items-center gap-6 flex-col")},m(n,d){q(n,e,d),P(e,o),P(o,t),P(o,h),se(m,o,null),P(e,v),P(e,u),P(u,p),P(u,_),P(_,w),P(u,M),P(e,R),P(e,D),P(e,X),P(e,E),se(f,E,null),P(E,ae),P(E,U),se(B,U,null),P(U,ne),s&&s.m(U,null),P(E,de),P(E,N),se(j,N,null),P(N,ue),a&&a.m(N,null),l=!0},p(n,d){const g={};d&67108864&&(g.$$scope={dirty:d,ctx:n}),m.$set(g);const $={};d&67108864&&($.$$scope={dirty:d,ctx:n}),f.$set($);const T={};d&67108864&&(T.$$scope={dirty:d,ctx:n}),B.$set(T),n[2]?s?(s.p(n,d),d&4&&C(s,1)):(s=Le(n),s.c(),C(s,1),s.m(U,null)):s&&(De(),x(s,1,1,()=>{s=null}),ye());const I={};d&67108864&&(I.$$scope={dirty:d,ctx:n}),j.$set(I),n[3]?a?(a.p(n,d),d&8&&C(a,1)):(a=Ve(n),a.c(),C(a,1),a.m(N,null)):a&&(De(),x(a,1,1,()=>{a=null}),ye())},i(n){l||(C(m.$$.fragment,n),C(f.$$.fragment,n),C(B.$$.fragment,n),C(s),C(j.$$.fragment,n),C(a),l=!0)},o(n){x(m.$$.fragment,n),x(f.$$.fragment,n),x(B.$$.fragment,n),x(s),x(j.$$.fragment,n),x(a),l=!1},d(n){n&&b(e),re(m),re(f),re(B),s&&s.d(),re(j),a&&a.d()}}}function to(r){let e;return{c(){e=W("Log out")},l(o){e=Q(o,"Log out")},m(o,t){q(o,e,t)},d(o){o&&b(e)}}}function so(r){let e;return{c(){e=W("Download Manga")},l(o){e=Q(o,"Download Manga")},m(o,t){q(o,e,t)},d(o){o&&b(e)}}}function ro(r){let e;return{c(){e=W("Upload volume data")},l(o){e=Q(o,"Upload volume data")},m(o,t){q(o,e,t)},d(o){o&&b(e)}}}function Le(r){let e,o;return e=new ce({props:{color:"alternative",$$slots:{default:[lo]},$$scope:{ctx:r}}}),e.$on("click",r[12]),{c(){oe(e.$$.fragment)},l(t){te(e.$$.fragment,t)},m(t,i){se(e,t,i),o=!0},p(t,i){const h={};i&67108864&&(h.$$scope={dirty:i,ctx:t}),e.$set(h)},i(t){o||(C(e.$$.fragment,t),o=!0)},o(t){x(e.$$.fragment,t),o=!1},d(t){re(e,t)}}}function lo(r){let e;return{c(){e=W("Download volume data")},l(o){e=Q(o,"Download volume data")},m(o,t){q(o,e,t)},d(o){o&&b(e)}}}function ao(r){let e;return{c(){e=W("Upload profiles")},l(o){e=Q(o,"Upload profiles")},m(o,t){q(o,e,t)},d(o){o&&b(e)}}}function Ve(r){let e,o;return e=new ce({props:{color:"alternative",$$slots:{default:[no]},$$scope:{ctx:r}}}),e.$on("click",r[14]),{c(){oe(e.$$.fragment)},l(t){te(e.$$.fragment,t)},m(t,i){se(e,t,i),o=!0},p(t,i){const h={};i&67108864&&(h.$$scope={dirty:i,ctx:t}),e.$set(h)},i(t){o||(C(e.$$.fragment,t),o=!0)},o(t){x(e.$$.fragment,t),o=!1},d(t){re(e,t)}}}function no(r){let e;return{c(){e=W("Download profiles")},l(o){e=Q(o,"Download profiles")},m(o,t){q(o,e,t)},d(o){o&&b(e)}}}function io(r){let e,o,t,i,h;const m=[oo,eo],v=[];function u(p,_){return p[0]?0:1}return t=u(r),i=v[t]=m[t](r),{c(){e=K(),o=F("div"),i.c(),this.h()},l(p){je("svelte-vx7v1c",document.head).forEach(b),e=Y(p),o=z(p,"DIV",{class:!0});var w=A(o);i.l(w),w.forEach(b),this.h()},h(){document.title="Cloud",y(o,"class","p-2 h-[90svh]")},m(p,_){q(p,e,_),q(p,o,_),v[t].m(o,null),h=!0},p(p,[_]){let w=t;t=u(p),t===w?v[t].p(p,_):(De(),x(v[w],1,1,()=>{v[w]=null}),ye(),i=v[t],i?i.p(p,_):(i=v[t]=m[t](p),i.c()),C(i,1),i.m(o,null))},i(p){h||(C(i),h=!0)},o(p){x(i),h=!1},d(p){p&&(b(e),b(o)),v[t].d()}}}const co="https://www.googleapis.com/discovery/v1/apis/drive/v3/rest",uo="https://www.googleapis.com/auth/drive.file",po="application/vnd.google-apps.folder",_e="mokuro-reader",xe="volume-data.json",Ae="profiles.json",ve="application/json";async function fo(r){try{const{result:e}=await gapi.client.drive.files.get({fileId:r,fields:"size"});return parseInt(e.size||"0",10)}catch(e){return console.error("Error getting file size:",e),0}}function mo(r,e,o){let{accessToken:t=""}=e;function i(l,s){const a=l.toString().toLowerCase();a.includes("network")||a.includes("connection")||a.includes("offline")||a.includes("internet")?Z("Connection error: Please check your internet connection"):(R(),Z(`Error ${s}: ${l.message||"Unknown error"}`)),console.error(`${s} error:`,l)}const h={}.VITE_GDRIVE_CLIENT_ID,m={}.VITE_GDRIVE_API_KEY;let v,u="",p="",_="";async function w(l){var a,n,d,g,$,T,I;if((l==null?void 0:l.error)!==void 0)throw localStorage.removeItem("gdrive_token"),o(0,t=""),l;o(0,t=l==null?void 0:l.access_token);const s="connect-drive";c.addProcess({id:s,description:"Connecting to Google Drive",progress:0,status:"Initializing connection..."});try{c.updateProcess(s,{progress:20,status:"Checking for reader folder..."});const{result:L}=await gapi.client.drive.files.list({q:`mimeType='application/vnd.google-apps.folder' and name='${_e}'`,fields:"files(id)"});if(((a=L.files)==null?void 0:a.length)===0){c.updateProcess(s,{progress:40,status:"Creating reader folder..."});const{result:ee}=await gapi.client.drive.files.create({resource:{mimeType:po,name:_e},fields:"id"});u=ee.id||""}else u=((d=(n=L.files)==null?void 0:n[0])==null?void 0:d.id)||""||"";c.updateProcess(s,{progress:60,status:"Checking for volume data..."});const{result:S}=await gapi.client.drive.files.list({q:`'${u}' in parents and name='${xe}'`,fields:"files(id, name)"});((g=S.files)==null?void 0:g.length)!==0&&o(2,p=(($=S.files)==null?void 0:$[0].id)||""),c.updateProcess(s,{progress:80,status:"Checking for profiles..."});const{result:ie}=await gapi.client.drive.files.list({q:`'${u}' in parents and name='${Ae}'`,fields:"files(id, name)"});((T=ie.files)==null?void 0:T.length)!==0&&o(3,_=((I=ie.files)==null?void 0:I[0].id)||""),c.updateProcess(s,{progress:100,status:"Connected successfully"}),setTimeout(()=>c.removeProcess(s),3e3),t&&Z("Connected to Google Drive")}catch(L){c.updateProcess(s,{progress:0,status:"Connection failed"}),setTimeout(()=>c.removeProcess(s),3e3),i(L,"connecting to Google Drive")}}function M(){v.requestAccessToken({prompt:"consent"})}function R(){if(localStorage.removeItem("gdrive_token"),o(0,t=""),gapi.client.getToken()){const l=gapi.client.getToken().access_token;gapi.client.setToken(null),fetch(`https://oauth2.googleapis.com/revoke?token=${l}`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"}}).catch(s=>{console.error("Error revoking token:",s)})}}Ge(()=>{gapi.load("client",async()=>{try{await gapi.client.init({apiKey:m,discoveryDocs:[co]}),v=google.accounts.oauth2.initTokenClient({client_id:h,scope:uo,callback:w});const l=localStorage.getItem("gdrive_token");if(l)try{gapi.client.setToken({access_token:l}),o(0,t=l),await w({access_token:l})}catch(s){console.error("Failed to restore saved token:",s)}}catch(l){i(l,"initializing Google Drive")}}),gapi.load("picker",()=>{})});function D(){const l=new google.picker.DocsView(google.picker.ViewId.DOCS).setMimeTypes("application/zip,application/x-zip-compressed,application/vnd.comicbook+zip,application/x-cbz").setMode(google.picker.DocsViewMode.LIST).setIncludeFolders(!0).setSelectFolderEnabled(!0).setParent(u),s=new google.picker.DocsView(google.picker.ViewId.FOLDERS).setSelectFolderEnabled(!0).setParent(u);new google.picker.PickerBuilder().addView(l).addView(s).setOAuthToken(t).setAppId(h).setDeveloperKey(m).enableFeature(google.picker.Feature.MULTISELECT_ENABLED).setCallback(f).build().setVisible(!0)}async function le(l){try{const{result:s}=await gapi.client.drive.files.list({q:`'${l}' in parents and (mimeType='application/zip' or mimeType='application/x-zip-compressed' or mimeType='application/vnd.comicbook+zip' or mimeType='application/x-cbz' or mimeType='application/vnd.google-apps.folder')`,fields:"files(id, name, mimeType)",pageSize:1e3});return s.files||[]}catch(s){return i(s,"listing files in folder"),[]}}async function X(l,s,a){const n=await le(l),d=[];for(let g=0;g<n.length;g++){const $=n[g];if(c.updateProcess(a,{status:`Scanning ${s} (${g+1}/${n.length}): ${$.name}`}),$.mimeType==="application/vnd.google-apps.folder"){const T=await X($.id,$.name,a);d.push(...T)}else d.push($)}return d}async function E(l,s){const{WorkerPool:a}=await Re(()=>import("../chunks/worker-pool.66fe55cc.js"),[],import.meta.url),n=s||`download-batch-${Date.now()}-${Math.random().toString(36).substring(2,9)}`,d=l.sort((V,G)=>V.name.localeCompare(G.name));let g=0,$={};s?c.updateProcess(n,{status:"Calculating total size...",progress:30}):c.addProcess({id:n,description:`Downloading ${d.length} files`,status:"Calculating total size...",progress:0,bytesLoaded:0,totalBytes:1});try{const V=d.map(k=>fo(k.id)),G=await Promise.all(V);d.forEach((k,ke)=>{const pe=G[ke];$[k.id]=pe,g+=pe})}catch(V){console.error("Error calculating total size:",V)}c.updateProcess(n,{status:`Preparing to download ${d.length} files`,totalBytes:g,bytesLoaded:0});const T=Math.min(navigator.hardwareConcurrency||4,6),I=500;console.log(`Creating worker pool with ${T} workers and ${I}MB memory threshold`);const L=new a(void 0,T,I),S={};let ie=0,ee=0;const we={},fe=()=>{let V=0;for(const k in S)V+=S[k];let G;s?G=30+V/g*70:G=V/g*100,c.updateProcess(n,{progress:G,bytesLoaded:V,status:`Downloaded ${ie} of ${d.length} files (${ee} failed)`})};return new Promise(V=>{const G=()=>{const k=L.memoryUsage;console.log(`Memory usage: ${(k.current/1048576).toFixed(2)}MB / ${(k.max/1048576).toFixed(2)}MB (${k.percentUsed.toFixed(2)}%)`),ie+ee===d.length&&(L.terminate(),c.updateProcess(n,{status:`All downloads complete (${ee} failed)`,progress:100,bytesLoaded:g}),s||setTimeout(()=>c.removeProcess(n),3e3),V())};for(const k of d){S[k.id]=0;const ke=$[k.id]||0,pe=Math.max(ke*3,50*1024*1024);console.log(`Adding task for ${k.name} with estimated memory requirement: ${(pe/(1024*1024)).toFixed(2)}MB`),L.addTask({id:k.id,memoryRequirement:pe,data:{fileId:k.id,fileName:k.name,accessToken:t},onProgress:O=>{S[k.id]=O.loaded,fe()},onComplete:async(O,Oe)=>{try{console.log(`Received complete message for ${O.fileName}`,{dataType:typeof O.data,dataSize:O.data.byteLength,hasData:!!O.data});const me=new Blob([O.data]);console.log(`Created blob of size ${me.size} bytes`);const ge=new File([me],O.fileName);console.log(`Created file object: ${ge.name}, size: ${ge.size} bytes`),await qe([ge]),console.log(`Successfully processed file: ${ge.name}`),ie++,S[k.id]=$[k.id]||0,we[k.id]=!0,fe(),G()}catch(me){console.error(`Error processing ${O.fileName}:`,me),Z(`Failed to process ${O.fileName}`),ee++,we[k.id]=!0,fe(),G()}finally{Oe()}},onError:O=>{console.error(`Error downloading ${k.name}:`,O.error),Z(`Failed to download ${k.name}`),ee++,S[k.id]=$[k.id]||0,we[k.id]=!0,fe(),G()}})}d.length===0&&(c.updateProcess(n,{status:"No files to download",progress:100}),s||setTimeout(()=>c.removeProcess(n),3e3),V())})}async function f(l){try{if(l[google.picker.Response.ACTION]==google.picker.Action.PICKED){const s=l[google.picker.Response.DOCUMENTS];if(s.length===0)return;const a=`download-process-${Date.now()}-${Math.random().toString(36).substring(2,9)}`;c.addProcess({id:a,description:`Processing ${s.length} items`,progress:0,status:"Starting scan..."});let n=[];try{for(let d=0;d<s.length;d++){const g=s[d],$=d/s.length*30;if(g.mimeType==="application/vnd.google-apps.folder"){c.updateProcess(a,{progress:$,status:`Scanning folder: ${g.name}`});const T=await X(g.id,g.name,a);n.push(...T)}else n.push(g)}if(n=n.filter(d=>{const g=d.mimeType.toLowerCase();return g.includes("zip")||g.includes("cbz")}),n.length===0){c.updateProcess(a,{progress:100,status:"No compatible files found"}),setTimeout(()=>c.removeProcess(a),3e3),Z("No compatible files found");return}c.updateProcess(a,{progress:30,status:`Found ${n.length} files to download`}),await E(n,a),setTimeout(()=>c.removeProcess(a),3e3)}catch(d){throw c.updateProcess(a,{progress:0,status:"Process failed"}),setTimeout(()=>c.removeProcess(a),3e3),d}}}catch(s){i(s,"processing files")}}async function ae(){const l={mimeType:ve,name:xe,parents:[p?null:u]},s="upload-volume-data";c.addProcess({id:s,description:"Uploading volume data",progress:0,status:"Starting upload..."});try{c.updateProcess(s,{progress:50,status:"Uploading..."});const a=await ze({accessToken:t,fileId:p,metadata:l,localStorageId:"volumes",type:ve});o(2,p=a.id),c.updateProcess(s,{progress:100,status:"Upload complete"}),setTimeout(()=>c.removeProcess(s),3e3),p&&Z("Volume data uploaded")}catch(a){c.updateProcess(s,{progress:0,status:"Upload failed"}),setTimeout(()=>c.removeProcess(s),3e3),i(a,"uploading volume data")}}async function U(){const l={mimeType:ve,name:Ae,parents:[_?null:u]},s="upload-profiles";c.addProcess({id:s,description:"Uploading profiles",progress:0,status:"Starting upload..."});try{c.updateProcess(s,{progress:50,status:"Uploading..."});const a=await ze({accessToken:t,fileId:_,metadata:l,localStorageId:"profiles",type:ve});o(3,_=a.id),c.updateProcess(s,{progress:100,status:"Upload complete"}),setTimeout(()=>c.removeProcess(s),3e3),_&&Z("Profiles uploaded")}catch(a){c.updateProcess(s,{progress:0,status:"Upload failed"}),setTimeout(()=>c.removeProcess(s),3e3),i(a,"uploading profiles")}}async function B(){const l="download-volume-data";c.addProcess({id:l,description:"Downloading volume data",progress:0,status:"Starting download..."});try{c.updateProcess(l,{progress:50,status:"Downloading..."});const{body:s}=await gapi.client.drive.files.get({fileId:p,alt:"media"}),a=Ze(s);He.update(n=>({...n,...a})),c.updateProcess(l,{progress:100,status:"Download complete"}),setTimeout(()=>c.removeProcess(l),3e3),Z("Volume data downloaded")}catch(s){c.updateProcess(l,{progress:0,status:"Download failed"}),setTimeout(()=>c.removeProcess(l),3e3),i(s,"downloading volume data")}}async function ne(){const l="download-profiles";c.addProcess({id:l,description:"Downloading profiles",progress:0,status:"Starting download..."});try{c.updateProcess(l,{progress:50,status:"Downloading..."});const{body:s}=await gapi.client.drive.files.get({fileId:_,alt:"media"}),a=JSON.parse(s);Ke.update(n=>({...n,...a})),c.updateProcess(l,{progress:100,status:"Download complete"}),setTimeout(()=>c.removeProcess(l),3e3),Z("Profiles downloaded")}catch(s){c.updateProcess(l,{progress:0,status:"Download failed"}),setTimeout(()=>c.removeProcess(l),3e3),i(s,"downloading profiles")}}const de=()=>he("Upload volume data?",ae),N=()=>he("Download and overwrite volume data?",B),j=()=>he("Upload profiles?",U),ue=()=>he("Download and overwrite profiles?",ne);return r.$$set=l=>{"accessToken"in l&&o(0,t=l.accessToken)},r.$$.update=()=>{r.$$.dirty&1&&t&&localStorage.setItem("gdrive_token",t)},[t,R,p,_,M,D,ae,U,B,ne,w,de,N,j,ue]}class Do extends Ue{constructor(e){super(),Be(this,e,mo,io,Me,{accessToken:0,connectDrive:10,logout:1})}get connectDrive(){return this.$$.ctx[10]}get logout(){return this.$$.ctx[1]}}export{Do as component};
